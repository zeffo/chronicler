{% extends "base.html" %}
{% block content %}

<style>
    input {
        background-color: var(--overlay0);
        border: none;
    }
    button {
        background-color: var(--mantle);
        border: none;
    }
    button:hover {
        background-color: var(--pink);
        color: var(--base);
    }
    textarea {
        background-color: var(--surface0);
        border: 1px solid var(--surface1);
    }

    .form-items {
        gap: 10px;
        padding: 30px;
    }


    .form-grid {
        display: grid;
        column-gap: 50px;
        row-gap: 20px;
        grid-template-columns: repeat(2, 1fr);
    }


    .result {
        padding: 100px;
    }

    .rule {
        display: flex;
        flex-direction: column;
        gap: 3px;
        padding: 5px;
        border: 1px solid var(--surface1);
        border-radius: 10px;
    }

    #ResultTable {
        border: 2px solid var(--text);
        padding: 10px;
        border-collapse: collapse;
    }

    #ResultTable td {
        padding: 10px;
    }

    #ResultTable th {
        color: var(--rosewater);
    }

    #ResultTable th, td {
        border: 2px solid var(--surface1);
    }

    .error {
        color: var(--red);
    }

</style>

SESSION: {{ session }}

Welcome! Configure your filters to get started:

<form method="post">
    <div class="container column form-items">
        <div class="form-grid">
            <div>
                Start:
                <input id="start" name="start" type="date" />
            </div>
            <div>
                End:
                <input id="end" name="end" type="date" />
            </div>
        </div>
    </table>
    <button id="add_rule" type="button"> Add Rule </button>
    <button id="submit" type="button"> Submit </button>
    </div>
</form>

<div class="result">
    {% if result %}
    <table id="ResultTable">
        <thead>
            <tr>
            {% for item in result[0] %}
                <th> {{ item }} </th>
            {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for item in result %}
            <tr>
                {% for key in result[0] %}
                <td> {{ item[key] }}</td>    
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
        {% if error %}
            <span class="error"> {{ error }} </span>
        {% endif %}
    {% endif %}
</div>


<script>
    $( document ).ready( () => {
        var count = $(".form-grid").length - 2;
        $(document).on("click", ".add_filter", (e) => {
            let parent = $(e.target).parent();
            parent.append(`<input class="filter" type='text'/>`)
        });

        $(document).on("click", "#add_rule", () => {
            let rule = `
                <div class="rule">
                    <div> Name: <input type="text" class="rule_name" /></div> <br>
                    <button type="button" class="add_filter"> Add Filter </button>
                </div>
            `;
            $(".form-grid").append(rule); 
        });

        $(document).on("click", "#submit", () => {
            let payload = {};
            payload["start"] = $("#start").val();
            payload["end"] = $("#end").val();
            payload["types"] = {}
            $(".rule").each( (i, rule) => {
                let items = [];
                $(rule).children(".filter").each( (j, filter) => {
                    items.push($(filter).val());
                });
                payload["types"][$(rule).find(".rule_name").first().val()] = items;
            });
            $.ajax({"data": JSON.stringify(payload), "method": "POST", "contentType": "application/json"})
        });
    });


</script>


{% endblock %}
